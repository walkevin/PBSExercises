\tdplotsetmaincoords{-20}{-40}
\begin{tikzpicture}[tdplot_main_coords,rotate=-40]
	\begin{scope}
		\node[align=center,anchor=north] (boa) at (0,-1em) {beam\\of atoms};
		\begin{scope}[shift={(2,0.5)},scale=0.5]
			\draw[fill=helsinkimorning] (0,3,1) -- (0,1,1) -- (4,1,1) -- (4,3,1) -- cycle;
			\draw[fill=helsinkimorning] (0,1,1) -- (0,0,0) -- (4,0,0) -- (4,1,1) -- cycle; 
			\draw[fill=helsinkimorning] (4,0,0) -- (4,1,-1) -- (4,3,-1) -- (4,3,1) -- (4,1,1) -- cycle; 
			\draw[fill=helsinkimorning] (0,3,1) -- (4,3,1) -- (4,3,-1) -- (0,3,-1) -- cycle;
			\node[white] (nul) at (2,2,1) {$N$};
			\foreach \x in {0,...,4}
				\coordinate[] (n\x) at (\x,0,0);
	\end{scope}
	\begin{scope}[shift={(2,-0.5)},scale=0.5]
		\draw[fill=rioday] (0,0,1) -- (4,0,1) -- (4,0,-1) -- (0,0,-1) -- cycle;
		\draw[fill=rioday] (0,0,1) -- (0,-3,1) -- (4,-3,1) -- (4,0,1) -- cycle;
		\draw[fill=rioday] (4,0,1) -- (4,-3,1) -- (4,-3,-1) -- (4,0,-1) -- cycle;
		\node[] (nll) at (2,-1.5,1) {$S$};
		\foreach \x in {0,...,4}
			\coordinate[] (s\x) at (\x,0,0);
	\end{scope}
		\foreach \x in {0,...,4}
			\draw[black!50,-latex,decoration={snake,post=lineto,post length=2mm},decorate] (n\x) -- (s\x);
		\node[align=center,anchor=south east] (imf) at (1.5,1) {inhomogeneous\\magnetic field};
		\draw[-latex] (imf.south) -- (1.8,0.25,0);
		\foreach \x/\y in {0.5/+\left| \vec{\upmu} \right|,0/0\;\left| \vec{\upmu} \right|,-0.5/-\left| \vec{\upmu} \right|}
		{
			\draw[domain=2:6.5,line width=2pt,label distance=0.5cm] plot[parametric,id=test\x] function{t,\x/10+\x*(t-2)**2/10} coordinate[label=right:$\y$] (p\x);
			\draw[domain=-1:2,line width=2pt] plot[parametric,id=test\x] function{t,\x/10};
		\draw[zyplane=6.5] (-1,-2.5) rectangle (1,2.5);
			\fill[zyplane=6.5] (0,{\x/10+\x*4.5^2/10}) circle (2pt);
		}
	\end{scope}
		\path[] (6.5,2.5,1) -- (6.5,-2.5,1) coordinate[label=below:screen] (screen);
\end{tikzpicture}
